!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button-submit",inactiveButtonClass:"modal__button-submit_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=t.id+"-error";document.querySelector("#"+o).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=n=>{const a=Array.from(n.querySelectorAll(e.inputSelector)),s=n.querySelector(e.submitButtonSelector);r(a,s,e),n.addEventListener("reset",(()=>{o(s,e)})),a.forEach((o=>{o.addEventListener("input",(function(){((e,r,o)=>{r.validity.valid?t(0,r,o):((e,t,r,o)=>{const n=t.id+"-error";document.querySelector("#"+n).textContent=r,t.classList.add(o.inputErrorClass)})(0,r,r.validationMessage,o)})(0,o,e),r(a,s,e)}))}))};function a(e,t,r,o){e.textContent=t?o:r}const s=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}addCardInfo(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"7ce32752-7f51-4ee3-8daa-e08858792089","Content-Type":"application/json"}});s.getAppInfo().then((e=>{let[t,r]=e;t.forEach((e=>{const t=N(e);E.append(t)})),u.textContent=r.name,m.textContent=r.about,U.src=r.avatar,U.alt=r.name})).catch(console.error);const i=document.querySelectorAll(".modal"),c=document.querySelector(".profile__edit-button"),l=document.querySelector("#profile-edit-modal"),d=l.querySelector(".modal__form"),u=(l.querySelector(".modal__button-close"),document.querySelector(".profile__name")),m=document.querySelector(".profile__description"),_=l.querySelector("#profile-name-input"),h=l.querySelector("#profile-description-input"),f=document.querySelector("#add-card-modal"),v=document.querySelector(".profile__new-post-button"),y=f.querySelector(".modal__form"),S=(f.querySelector(".modal__button-close"),f.querySelector(".modal__button-submit")),b=y.querySelector("#add-card-link-input"),p=y.querySelector("#add-card-caption-input"),q=document.querySelector("#card-template"),E=document.querySelector(".cards__list"),C=document.querySelector("#preview-modal"),k=C.querySelector(".modal__image"),L=C.querySelector(".modal__caption"),g=document.querySelector("#avatar-modal"),x=document.querySelector(".profile__avatar-button"),$=g.querySelector(".modal__form"),j=(g.querySelector(".modal__button-submit"),$.querySelector("#avatar-input")),U=document.querySelector(".profile__avatar"),I=document.querySelector("#delete-modal"),P=I.querySelector(".modal__form");let A,D;function T(e){e.classList.add("modal_open"),document.addEventListener("keydown",B)}function w(e){e.classList.remove("modal_open"),document.removeEventListener("keydown",B)}function B(e){if("Escape"===e.key){const e=document.querySelector(".modal_open");e&&w(e)}}function N(e){const t=q.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return r.textContent=e.name,o.src=e.link,o.alt=e.name,e.isLiked&&n.classList.add("card__like-button_liked"),n.addEventListener("click",(t=>{const r=t.target.classList.contains("card__like-button_liked");s.changeLikeStatus(e._id,r).then((e=>{n.classList.toggle("card__like-button_liked")})).catch(console.error)})),a.addEventListener("click",(()=>{A=t,D=e._id,T(I)})),o.addEventListener("click",(()=>{T(C),k.src=e.link,k.alt=e.name,L.textContent=e.name})),t}x.addEventListener("click",(()=>{T(g)})),$.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,t.textContent,"Saving..."),s.editAvatarInfo(j.value).then((e=>{U.src=e.avatar,w(g)})).catch(console.error).finally((()=>{a(t,!1,t.textContent,"Saving...")}))})),document.querySelectorAll(".modal__button-close"),i.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("modal_open")&&w(e),t.target.classList.contains("modal__button-close")&&w(e),t.target.classList.contains("modal__button-submit_cancel")&&w(e)}))})),c.addEventListener("click",(()=>{_.value=u.textContent,h.value=m.textContent,((e,r,o)=>{r.forEach((e=>{t(0,e,o)}))})(0,[_,h],e),T(l)})),d.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,t.textContent,"Saving..."),s.editUserInfo({name:_.value,about:h.value}).then((e=>{u.textContent=e.name,m.textContent=e.about,w(l)})).catch(console.error).finally((()=>{a(t,!1,t.textContent,"Saving...")}))})),P.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,t.textContent,"Deleting..."),s.deleteCard(D).then((e=>{w(I),A.remove()})).catch(console.error).finally((()=>{a(t,!1,t.textContent,"Deleting...")}))})),v.addEventListener("click",(()=>{T(f)})),y.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter;a(r,!0,r.textContent,"Saving..."),s.addCardInfo({name:p.value,link:b.value}).then((t=>{const r=N(t);E.prepend(r),w(f),y.reset(),o(S,e)})).catch(console.error).finally((()=>{a(r,!1,r.textContent,"Saving...")}))})),function(e){document.querySelectorAll(e.formSelector).forEach((e=>{n(e)}))}(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUF1QnpCRSxFQUFZeEUsaUJBQWlCLFVBcEI3QixTQUFpQzZGLEdBQy9CQSxFQUFJYyxpQkFFSixNQUFNQyxFQUFhZixFQUFJZ0IsVUFDdkJ2RyxFQUFjc0csR0FBWSxFQUFNQSxFQUFXOUgsWUFBYSxhQUN4RDZCLEVBQ0c4QixZQUFZLENBQUVQLEtBQU15QyxFQUFpQm1DLE1BQU9uRSxLQUFNK0IsRUFBY29DLFFBQ2hFckYsTUFBTXVFLElBQ0wsTUFBTTVDLEVBQWNDLEVBQWUyQyxHQUNuQzFDLEVBQVU0RCxRQUFROUQsR0FDbEJ1QyxFQUFXckIsR0FDWEUsRUFBWTJDLFFBQ1oxSCxFQUFjZ0YsRUFBcUJ6RyxFQUFTLElBRTdDNkYsTUFBTUMsUUFBUUMsT0FDZGdELFNBQVEsS0FDUHpHLEVBQWNzRyxHQUFZLEVBQU9BLEVBQVc5SCxZQUFhLFlBQVksR0FFM0UsSUZsT08sU0FBMEJkLEdBQ2RZLFNBQVNtQixpQkFBaUIvQixFQUFTQyxjQUMzQ2dDLFNBQVN6QixJQUNoQm9CLEVBQWtCcEIsRUFBc0IsR0FFNUMsQ0VpT0E0SSxDQUFpQnBKLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uLXN1Ym1pdFwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b24tc3VibWl0X2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1zZywgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dJZCA9IGlucHV0RWxlbWVudC5pZCArIFwiLWVycm9yXCI7XG4gIGNvbnN0IGVycm9yTXNnRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjXCIgKyBlcnJvck1zZ0lkKTtcbiAgZXJyb3JNc2dFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNc2c7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0lkID0gaW5wdXRFbGVtZW50LmlkICsgXCItZXJyb3JcIjtcbiAgY29uc3QgZXJyb3JNc2dFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNcIiArIGVycm9yTXNnSWQpO1xuICBlcnJvck1zZ0VsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICBmb3JtRWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgIHNldHRpbmdzXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgc2V0dGluZ3MpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBzZXR0aW5ncyk7XG4gIH0pO1xufTtcbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50KSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICApO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuXG4gIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNldFwiLCAoKSA9PiB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG4gIH0pO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncykge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcbn1cbiIsImV4cG9ydCBmdW5jdGlvbiBzZXRCdXR0b25UZXh0KGJ1dHRvbiwgaXNMb2FkaW5nLCBkZWZhdWx0VGV4dCwgbG9hZGluZ1RleHQpIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICB9XG59XG4iLCJpbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcblxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBicmlkZ2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG5dO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI3Y2UzMjc1Mi03ZjUxLTRlZTMtOGRhYS1lMDg4NTg3OTIwODlcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCBwcm9maWxlSW5mb10pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgY2FyZHNMaXN0LmFwcGVuZChjYXJkRWxlbWVudCk7XG4gICAgfSk7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBwcm9maWxlSW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHByb2ZpbGVJbmZvLmFib3V0O1xuICAgIGF2YXRhckltYWdlRWxlbWVudC5zcmMgPSBwcm9maWxlSW5mby5hdmF0YXI7XG4gICAgYXZhdGFySW1hZ2VFbGVtZW50LmFsdCA9IHByb2ZpbGVJbmZvLm5hbWU7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuLy8gR2VuZXJhbCB2YXJpYWJsZVxuY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcblxuLy8gUHJvZmlsZSB2YXJpYWJsZXNcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0Rm9ybSA9IHByb2ZpbGVFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IHByb2ZpbGVDbG9zZUJ1dHRvbiA9IHByb2ZpbGVFZGl0TW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiXG4pO1xuXG4vLyBQcm9maWxlIEZvcm0gdmFyaWFibGVzXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBwcm9maWxlTmFtZUlucHV0ID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5cbi8vIE5ldyBwb3N0L2FkZCBjYXJkIHZhcmlhbGJlc1xuY29uc3QgYWRkQ2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGFkZENhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25ldy1wb3N0LWJ1dHRvblwiKTtcbmNvbnN0IGFkZENhcmRGb3JtID0gYWRkQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCIpO1xuY29uc3QgYWRkQ2FyZEJ1dHRvblN1Ym1pdCA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b24tc3VibWl0XCIpO1xuXG4vLyBOZXcgcG9zdC9hZGQgY2FyZCBmb3JtIHZhcmlhYmxlc1xuY29uc3QgY2FyZExpbmtJbnB1dCA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbGluay1pbnB1dFwiKTtcbmNvbnN0IGNhcmRDYXB0aW9uSW5wdXQgPSBhZGRDYXJkRm9ybS5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLWNhcHRpb24taW5wdXRcIik7XG5cbi8vIENhcmQgbGlzdCB2YXJpYWJsZXNcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vIFByZXZpZXcgbW9kYWwgRWxlbWVudCBzZWxlY3RvclxuY29uc3QgcHJldmlld01vZGFsRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbEltYWdlID0gcHJldmlld01vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENhcHRpb24gPVxuICBwcmV2aWV3TW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG4vL2NvbnN0IHByZXZpZXdNb2RhbENsb3NlQnV0dG9uID0gcHJldmlld01vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuLy8gIFwiLm1vZGFsX19idXR0b24tY2xvc2VcIlxuLy8pO1xuXG4vLyBBdmF0YXIgZm9ybSBlbGVtZW50c1xuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ1dHRvblwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuLy9jb25zdCBhdmF0YXJDbG9zZUJ1dHRvbiA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiKTtcbmNvbnN0IGF2YXRhckJ1dHRvblN1Ym1pdCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1zdWJtaXRcIik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItaW5wdXRcIik7XG5jb25zdCBhdmF0YXJJbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuLy8gRGVsZXRlIGZvcm0gZWxlbWVudHMgYW5kIGNvbnN0c1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcblxuLy8gR2VuZXJhbCBmb3JtIGZ1bmN0aW9uc1xuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGUpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGUpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFc2NhcGUoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgYWN0aXZlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5cIik7XG4gICAgaWYgKGFjdGl2ZU1vZGFsKSB7XG4gICAgICBjbG9zZU1vZGFsKGFjdGl2ZU1vZGFsKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gZWRpdCBhdmF0YXIgZnVuY3Rpb25zXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzYXZlQnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzYXZlQnV0dG9uLCB0cnVlLCBzYXZlQnV0dG9uLnRleHRDb250ZW50LCBcIlNhdmluZy4uLlwiKTtcbiAgYXBpXG4gICAgLmVkaXRBdmF0YXJJbmZvKGF2YXRhcklucHV0LnZhbHVlKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBhdmF0YXJJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc2F2ZUJ1dHRvbiwgZmFsc2UsIHNhdmVCdXR0b24udGV4dENvbnRlbnQsIFwiU2F2aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuXG5hdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbi8vIEZpbmQgYWxsIGNsb3NlIGJ1dHRvbnNcbmNvbnN0IGNsb3NlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiKTtcblxuLy8gSGFuZGxlIG1vZGFsIGNsb3NpbmcgYWZ0ZXIgY2xpY2tpbmcgb3ZlcmxheSBvciBjbG9zZSBidXR0b25cbm1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuXCIpKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2J1dHRvbi1jbG9zZVwiKSkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX19idXR0b24tc3VibWl0X2NhbmNlbFwiKSkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG4vLyBFZGl0IHByb2ZpbGUgZnVuY3Rpb25zXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzYXZlQnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzYXZlQnV0dG9uLCB0cnVlLCBzYXZlQnV0dG9uLnRleHRDb250ZW50LCBcIlNhdmluZy4uLlwiKTtcbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBwcm9maWxlTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHNhdmVCdXR0b24sIGZhbHNlLCBzYXZlQnV0dG9uLnRleHRDb250ZW50LCBcIlNhdmluZy4uLlwiKTtcbiAgICB9KTtcbn1cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBwcm9maWxlRWRpdEZvcm0sXG4gICAgW3Byb2ZpbGVOYW1lSW5wdXQsIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcbiAgICBzZXR0aW5nc1xuICApO1xuICBvcGVuTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XG59KTtcblxucHJvZmlsZUVkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUVkaXRGb3JtU3VibWl0KTtcblxuLy8gQ2FyZCBmdW5jdGlvbnNcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudFxuICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xuXG4gIGNvbnN0IGNhcmRUaXRsZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuXG4gIGNhcmRUaXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcblxuICAvL21haW50YWlucyBhY3RpdmUgc3RhdHVzIHRvIGxpa2UgYWZ0ZXIgcmVmcmVzaFxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBjb25zdCBpc0xpa2VkID0gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgICBhcGlcbiAgICAgIC5jaGFuZ2VMaWtlU3RhdHVzKGRhdGEuX2lkLCBpc0xpa2VkKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSk7XG5cbiAgY2FyZERlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIC8vY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbEVsZW1lbnQpO1xuICAgIHByZXZpZXdNb2RhbEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vL2hhbmRsZSBkZWxldGUgZm9ybSByZXF1ZXN0IGxpc3RlbmVyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBkZWxldGVCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KGRlbGV0ZUJ1dHRvbiwgdHJ1ZSwgZGVsZXRlQnV0dG9uLnRleHRDb250ZW50LCBcIkRlbGV0aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KFxuICAgICAgICBkZWxldGVCdXR0b24sXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBkZWxldGVCdXR0b24udGV4dENvbnRlbnQsXG4gICAgICAgIFwiRGVsZXRpbmcuLi5cIlxuICAgICAgKTtcbiAgICB9KTtcbn1cblxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG4vL2FkZCBjYW5jZWwgZXZlbnQgbGlzdGVuZXJcbi8vIE5ldy9hZGQgY2FyZCBmdW5jdGlvbnNcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGFkZENhcmRNb2RhbCk7XG59KTtcblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAvL2NvbnN0IG5ld0NhcmQgPSB7IG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfTtcbiAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc2F2ZUJ1dHRvbiwgdHJ1ZSwgc2F2ZUJ1dHRvbi50ZXh0Q29udGVudCwgXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5hZGRDYXJkSW5mbyh7IG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICAgIGNsb3NlTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbiAgICAgIGFkZENhcmRGb3JtLnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGFkZENhcmRCdXR0b25TdWJtaXQsIHNldHRpbmdzKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc2F2ZUJ1dHRvbiwgZmFsc2UsIHNhdmVCdXR0b24udGV4dENvbnRlbnQsIFwiU2F2aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuXG5hZGRDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuICBlZGl0QXZhdGFySW5mbyhhdmF0YXIpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZENhcmRJbmZvKHsgbmFtZSwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgY2hhbmdlTGlrZVN0YXR1cyhjYXJkSWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yTXNnSWQiLCJpZCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJmb3JFYWNoIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIiwic2V0QnV0dG9uVGV4dCIsImJ1dHRvbiIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwibG9hZGluZ1RleHQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsIm1ldGhvZCIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImFkZENhcmRJbmZvIiwiX3JlZjMiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImNoYW5nZUxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwicHJvZmlsZUluZm8iLCJjYXJkIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsImFwcGVuZCIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwiYXZhdGFySW1hZ2VFbGVtZW50Iiwic3JjIiwiYWx0IiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJtb2RhbHMiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVFZGl0TW9kYWwiLCJwcm9maWxlRWRpdEZvcm0iLCJwcm9maWxlTmFtZUlucHV0IiwicHJvZmlsZURlc2NyaXB0aW9uSW5wdXQiLCJhZGRDYXJkTW9kYWwiLCJhZGRDYXJkQnV0dG9uIiwiYWRkQ2FyZEZvcm0iLCJhZGRDYXJkQnV0dG9uU3VibWl0IiwiY2FyZExpbmtJbnB1dCIsImNhcmRDYXB0aW9uSW5wdXQiLCJjYXJkVGVtcGxhdGUiLCJwcmV2aWV3TW9kYWxFbGVtZW50IiwicHJldmlld01vZGFsSW1hZ2UiLCJwcmV2aWV3TW9kYWxDYXB0aW9uIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJCdXR0b24iLCJhdmF0YXJGb3JtIiwiYXZhdGFySW5wdXQiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiaGFuZGxlRXNjYXBlIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJhY3RpdmVNb2RhbCIsImRhdGEiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlRWxlbWVudCIsImNhcmRJbWFnZUVsZW1lbnQiLCJjYXJkTGlrZUJ1dHRvbiIsImNhcmREZWxldGVCdXR0b24iLCJ0YXJnZXQiLCJjb250YWlucyIsIl9pZCIsInRvZ2dsZSIsInByZXZlbnREZWZhdWx0Iiwic2F2ZUJ1dHRvbiIsInN1Ym1pdHRlciIsInZhbHVlIiwiZmluYWxseSIsInJlc2V0VmFsaWRhdGlvbiIsImRlbGV0ZUJ1dHRvbiIsInByZXBlbmQiLCJyZXNldCIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9