!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button-submit",inactiveButtonClass:"modal__button-submit_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=t.id+"-error";document.querySelector("#"+o).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=n=>{const a=Array.from(n.querySelectorAll(e.inputSelector)),s=n.querySelector(e.submitButtonSelector);r(a,s,e),n.addEventListener("reset",(()=>{o(s,e)})),a.forEach((o=>{o.addEventListener("input",(function(){((e,r,o)=>{r.validity.valid?t(0,r,o):((e,t,r,o)=>{const n=t.id+"-error";document.querySelector("#"+n).textContent=r,t.classList.add(o.inputErrorClass)})(0,r,r.validationMessage,o)})(0,o,e),r(a,s,e)}))}))};function a(e,t,r,o){e.textContent=t?o:r}const s=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo(),this.getAvatarInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getAvatarInfo(){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}addCardInfo(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"7ce32752-7f51-4ee3-8daa-e08858792089","Content-Type":"application/json"}});s.getAppInfo().then((e=>{let[t,r,o]=e;var n;t.forEach((e=>{const t=N(e);E.append(t)})),u.textContent=r.name,m.textContent=r.about,n=o,U.src=n.link})).catch(console.error);const i=document.querySelectorAll(".modal"),c=document.querySelector(".profile__edit-button"),l=document.querySelector("#profile-edit-modal"),d=l.querySelector(".modal__form"),u=(l.querySelector(".modal__button-close"),document.querySelector(".profile__name")),m=document.querySelector(".profile__description"),_=l.querySelector("#profile-name-input"),h=l.querySelector("#profile-description-input"),f=document.querySelector("#add-card-modal"),v=document.querySelector(".profile__new-post-button"),y=f.querySelector(".modal__form"),S=(f.querySelector(".modal__button-close"),f.querySelector(".modal__button-submit")),b=y.querySelector("#add-card-link-input"),p=y.querySelector("#add-card-caption-input"),q=document.querySelector("#card-template"),E=document.querySelector(".cards__list"),C=document.querySelector("#preview-modal"),k=C.querySelector(".modal__image"),L=C.querySelector(".modal__caption"),g=document.querySelector("#avatar-modal"),x=document.querySelector(".profile__avatar-button"),$=g.querySelector(".modal__form"),j=(g.querySelector(".modal__button-submit"),$.querySelector("#avatar-input")),U=document.querySelector(".profile__avatar"),I=document.querySelector("#delete-modal"),A=I.querySelector(".modal__form");let P,T;function D(e){e.classList.add("modal_open"),document.addEventListener("keydown",B)}function w(e){e.classList.remove("modal_open"),document.removeEventListener("keydown",B)}function B(e){if("Escape"===e.key){const e=document.querySelector(".modal_open");e&&w(e)}}function N(e){const t=q.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return r.textContent=e.name,o.src=e.link,o.alt=e.name,e.isLiked&&n.classList.add("card__like-button_liked"),n.addEventListener("click",(t=>{const r=t.target.classList.contains("card__like-button_liked");s.changeLikeStatus(e._id,r).then((e=>{n.classList.toggle("card__like-button_liked")})).catch(console.error)})),a.addEventListener("click",(()=>{P=t,T=e._id,D(I)})),o.addEventListener("click",(()=>{D(C),k.src=e.link,k.alt=e.name,L.textContent=e.name})),t}x.addEventListener("click",(()=>{D(g)})),$.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,t.textContent,"Saving..."),s.editAvatarInfo(j.value).then((e=>{j.textContent=e.avatar,w(g)})).catch(console.error).finally((()=>{a(t,!1,t.textContent,"Saving...")}))})),document.querySelectorAll(".modal__button-close"),i.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("modal_open")&&w(e),t.target.classList.contains("modal__button-close")&&w(e),t.target.classList.contains("modal__button-submit_cancel")&&w(e)}))})),c.addEventListener("click",(()=>{_.value=u.textContent,h.value=m.textContent,((e,r,o)=>{r.forEach((e=>{t(0,e,o)}))})(0,[_,h],e),D(l)})),d.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,t.textContent,"Saving..."),s.editUserInfo({name:_.value,about:h.value}).then((e=>{u.textContent=e.name,m.textContent=e.about,w(l)})).catch(console.error).finally((()=>{a(t,!1,t.textContent,"Saving...")}))})),A.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(t,!0,t.textContent,"Deleting..."),s.deleteCard(T).then((e=>{w(I),P.remove()})).catch(console.error).finally((()=>{a(t,!1,t.textContent,"Deleting...")}))})),v.addEventListener("click",(()=>{D(f)})),y.addEventListener("submit",(function(t){t.preventDefault();const r=t.submitter;a(r,!0,r.textContent,"Saving..."),s.addCardInfo({name:p.value,link:b.value}).then((t=>{const r=N(t);E.prepend(r),w(f),y.reset(),o(S,e)})).catch(console.error).finally((()=>{a(r,!1,r.textContent,"Saving...")}))})),function(e){document.querySelectorAll(e.formSelector).forEach((e=>{n(e)}))}(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQU8sTUFBTUEsRUFBVyxDQUN0QkMsYUFBYyxlQUNkQyxjQUFlLGdCQUNmQyxxQkFBc0Isd0JBQ3RCQyxvQkFBcUIsZ0NBQ3JCQyxnQkFBaUIsMEJBQ2pCQyxXQUFZLHdCQVVSQyxFQUFpQkEsQ0FBQ0MsRUFBYUMsRUFBY1QsS0FDakQsTUFBTVUsRUFBYUQsRUFBYUUsR0FBSyxTQUNiQyxTQUFTQyxjQUFjLElBQU1ILEdBQ3JDSSxZQUFjLEdBQzlCTCxFQUFhTSxVQUFVQyxPQUFPaEIsRUFBU0ssZ0JBQWdCLEVBcUJuRFksRUFBb0JBLENBQUNDLEVBQVdDLEVBQWVuQixLQUw1QmtCLElBQ2hCQSxFQUFVRSxNQUFNQyxJQUNiQSxFQUFNQyxTQUFTQyxRQUlyQkMsQ0FBZ0JOLEdBQ2xCTyxFQUFjTixFQUFlbkIsSUFFN0JtQixFQUFjTyxVQUFXLEVBQ3pCUCxFQUFjSixVQUFVQyxPQUFPaEIsRUFBU0kscUJBQzFDLEVBR1dxQixFQUFnQkEsQ0FBQ04sRUFBZW5CLEtBQzNDbUIsRUFBY08sVUFBVyxFQUN6QlAsRUFBY0osVUFBVVksSUFBSTNCLEVBQVNJLG9CQUFvQixFQVFyRHdCLEVBQXFCcEIsSUFDekIsTUFBTVUsRUFBWVcsTUFBTUMsS0FDdEJ0QixFQUFZdUIsaUJBQWlCL0IsRUFBU0UsZ0JBRWxDaUIsRUFBZ0JYLEVBQVlLLGNBQ2hDYixFQUFTRyxzQkFHWGMsRUFBa0JDLEVBQVdDLEVBQWVuQixHQUU1Q1EsRUFBWXdCLGlCQUFpQixTQUFTLEtBQ3BDUCxFQUFjTixFQUFlbkIsRUFBUyxJQUd4Q2tCLEVBQVVlLFNBQVN4QixJQUNqQkEsRUFBYXVCLGlCQUFpQixTQUFTLFdBcERoQkUsRUFBQzFCLEVBQWFDLEVBQWNULEtBQ2hEUyxFQUFhYSxTQUFTQyxNQVF6QmhCLEVBQWVDLEVBQWFDLEVBQWNULEdBdkJ2Qm1DLEVBQUMzQixFQUFhQyxFQUFjMkIsRUFBVXBDLEtBQzNELE1BQU1VLEVBQWFELEVBQWFFLEdBQUssU0FDYkMsU0FBU0MsY0FBYyxJQUFNSCxHQUNyQ0ksWUFBY3NCLEVBQzlCM0IsRUFBYU0sVUFBVVksSUFBSTNCLEVBQVNLLGdCQUFnQixFQVlsRDhCLENBQ0UzQixFQUNBQyxFQUNBQSxFQUFhNEIsa0JBQ2JyQyxFQUlKLEVBMkNJa0MsQ0FBbUIxQixFQUFhQyxFQUFjVCxHQUM5Q2lCLEVBQWtCQyxFQUFXQyxFQUFlbkIsRUFDOUMsR0FBRSxHQUNGLEVDL0VHLFNBQVNzQyxFQUFjQyxFQUFRQyxFQUFXQyxFQUFhQyxHQUUxREgsRUFBT3pCLFlBREwwQixFQUNtQkUsRUFFQUQsQ0FFekIsQ0NJQSxNQStCTUUsRUFBTSxJQ3pDWixNQUNFQyxXQUFBQSxDQUFXQyxHQUF1QixJQUF0QixRQUFFQyxFQUFPLFFBQUVDLEdBQVNGLEVBQzlCRyxLQUFLQyxTQUFXSCxFQUNoQkUsS0FBS0UsU0FBV0gsQ0FDbEIsQ0FFQUksVUFBQUEsR0FDRSxPQUFPQyxRQUFRQyxJQUFJLENBQ2pCTCxLQUFLTSxrQkFDTE4sS0FBS08sY0FDTFAsS0FBS1EsaUJBRVQsQ0FFQUYsZUFBQUEsR0FDRSxPQUFPRyxNQUFNLEdBQUdULEtBQUtDLGlCQUFrQixDQUNyQ0YsUUFBU0MsS0FBS0UsV0FDYlEsTUFBTUMsSUFDUCxHQUFJQSxFQUFJQyxHQUNOLE9BQU9ELEVBQUlFLE9BRWJULFFBQVFVLE9BQU8sVUFBVUgsRUFBSUksU0FBUyxHQUUxQyxDQUVBUixXQUFBQSxHQUNFLE9BQU9FLE1BQU0sR0FBR1QsS0FBS0Msb0JBQXFCLENBQ3hDZSxPQUFRLE1BQ1JqQixRQUFTQyxLQUFLRSxXQUNiUSxNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBRUFFLFlBQUFBLENBQVlDLEdBQWtCLElBQWpCLEtBQUVDLEVBQUksTUFBRUMsR0FBT0YsRUFDMUIsT0FBT1QsTUFBTSxHQUFHVCxLQUFLQyxvQkFBcUIsQ0FDeENlLE9BQVEsUUFDUmpCLFFBQVNDLEtBQUtFLFNBRWRtQixLQUFNQyxLQUFLQyxVQUFVLENBQ25CSixPQUNBQyxZQUVEVixNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBQ0FTLGNBQUFBLENBQWVDLEdBQ2IsT0FBT2hCLE1BQU0sR0FBR1QsS0FBS0MsMkJBQTRCLENBQy9DZSxPQUFRLFFBQ1JqQixRQUFTQyxLQUFLRSxTQUVkbUIsS0FBTUMsS0FBS0MsVUFBVSxDQUNuQkUsYUFFRGYsTUFBTUMsSUFDUCxHQUFJQSxFQUFJQyxHQUNOLE9BQU9ELEVBQUlFLE9BRWJULFFBQVFVLE9BQU8sVUFBVUgsRUFBSUksU0FBUyxHQUUxQyxDQUVBUCxhQUFBQSxHQUNFLE9BQU9DLE1BQU0sR0FBR1QsS0FBS0MsMkJBQTRCLENBQy9DZSxPQUFRLE1BQ1JqQixRQUFTQyxLQUFLRSxXQUNiUSxNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBRUFXLFdBQUFBLENBQVdDLEdBQWlCLElBQWhCLEtBQUVSLEVBQUksS0FBRVMsR0FBTUQsRUFDeEIsT0FBT2xCLE1BQU0sR0FBR1QsS0FBS0MsaUJBQWtCLENBQ3JDZSxPQUFRLE9BQ1JqQixRQUFTQyxLQUFLRSxTQUVkbUIsS0FBTUMsS0FBS0MsVUFBVSxDQUNuQkosT0FDQVMsV0FFRGxCLE1BQU1DLElBQ1AsR0FBSUEsRUFBSUMsR0FDTixPQUFPRCxFQUFJRSxPQUViVCxRQUFRVSxPQUFPLFVBQVVILEVBQUlJLFNBQVMsR0FFMUMsQ0FDQWMsVUFBQUEsQ0FBV0MsR0FDVCxPQUFPckIsTUFBTSxHQUFHVCxLQUFLQyxrQkFBa0I2QixJQUFVLENBQy9DZCxPQUFRLFNBQ1JqQixRQUFTQyxLQUFLRSxXQUNiUSxNQUFNQyxJQUNQLEdBQUlBLEVBQUlDLEdBQ04sT0FBT0QsRUFBSUUsT0FFYlQsUUFBUVUsT0FBTyxVQUFVSCxFQUFJSSxTQUFTLEdBRTFDLENBRUFnQixnQkFBQUEsQ0FBaUJELEVBQVFFLEdBQ3ZCLE9BQU92QixNQUFNLEdBQUdULEtBQUtDLGtCQUFrQjZCLFVBQWdCLENBQ3JEZCxPQUFRZ0IsRUFBVSxTQUFXLE1BQzdCakMsUUFBU0MsS0FBS0UsV0FDYlEsTUFBTUMsSUFDUCxHQUFJQSxFQUFJQyxHQUNOLE9BQU9ELEVBQUlFLE9BRWJULFFBQVFVLE9BQU8sVUFBVUgsRUFBSUksU0FBUyxHQUUxQyxHRDlFa0IsQ0FDbEJqQixRQUFTLGtEQUNUQyxRQUFTLENBQ1BrQyxjQUFlLHVDQUNmLGVBQWdCLHNCQUlwQnRDLEVBQ0dRLGFBQ0FPLE1BQUtiLElBQXVDLElBQXJDcUMsRUFBT0MsRUFBYUMsR0FBWXZDLEVBeUYxQyxJQUF3QndDLEVBeEZwQkgsRUFBTWpELFNBQVNxRCxJQUNiLE1BQU1DLEVBQWNDLEVBQWVGLEdBQ25DRyxFQUFVQyxPQUFPSCxFQUFZLElBRS9CSSxFQUFZN0UsWUFBY3FFLEVBQVloQixLQUN0Q3lCLEVBQW1COUUsWUFBY3FFLEVBQVlmLE1BbUZ6QmlCLEVBbEZMRCxFQW1GakJTLEVBQW1CQyxJQUFNVCxFQUFLVCxJQW5GRCxJQUU1Qm1CLE1BQU1DLFFBQVFDLE9BR2pCLE1BQU1DLEVBQVN0RixTQUFTbUIsaUJBQWlCLFVBR25Db0UsRUFBb0J2RixTQUFTQyxjQUFjLHlCQUMzQ3VGLEVBQW1CeEYsU0FBU0MsY0FBYyx1QkFDMUN3RixFQUFrQkQsRUFBaUJ2RixjQUFjLGdCQU1qRDhFLEdBTHFCUyxFQUFpQnZGLGNBQzFDLHdCQUlrQkQsU0FBU0MsY0FBYyxtQkFDckMrRSxFQUFxQmhGLFNBQVNDLGNBQWMseUJBQzVDeUYsRUFBbUJGLEVBQWlCdkYsY0FBYyx1QkFDbEQwRixFQUEwQkgsRUFBaUJ2RixjQUMvQyw4QkFJSTJGLEVBQWU1RixTQUFTQyxjQUFjLG1CQUN0QzRGLEVBQWdCN0YsU0FBU0MsY0FBYyw2QkFDdkM2RixFQUFjRixFQUFhM0YsY0FBYyxnQkFFekM4RixHQURxQkgsRUFBYTNGLGNBQWMsd0JBQzFCMkYsRUFBYTNGLGNBQWMsMEJBR2pEK0YsRUFBZ0JGLEVBQVk3RixjQUFjLHdCQUMxQ2dHLEVBQW1CSCxFQUFZN0YsY0FBYywyQkFHN0NpRyxFQUFlbEcsU0FBU0MsY0FBYyxrQkFDdEM0RSxFQUFZN0UsU0FBU0MsY0FBYyxnQkFHbkNrRyxFQUFzQm5HLFNBQVNDLGNBQWMsa0JBQzdDbUcsRUFBb0JELEVBQW9CbEcsY0FBYyxpQkFDdERvRyxFQUNKRixFQUFvQmxHLGNBQWMsbUJBTTlCcUcsRUFBY3RHLFNBQVNDLGNBQWMsaUJBQ3JDc0csRUFBZXZHLFNBQVNDLGNBQWMsMkJBQ3RDdUcsRUFBYUYsRUFBWXJHLGNBQWMsZ0JBR3ZDd0csR0FEcUJILEVBQVlyRyxjQUFjLHlCQUNqQ3VHLEVBQVd2RyxjQUFjLGtCQUN2Q2dGLEVBQXFCakYsU0FBU0MsY0FBYyxvQkFHNUN5RyxFQUFjMUcsU0FBU0MsY0FBYyxpQkFDckMwRyxFQUFhRCxFQUFZekcsY0FBYyxnQkFDN0MsSUFBSTJHLEVBQ0FDLEVBR0osU0FBU0MsRUFBVUMsR0FDakJBLEVBQU01RyxVQUFVWSxJQUFJLGNBQ3BCZixTQUFTb0IsaUJBQWlCLFVBQVc0RixFQUN2QyxDQUVBLFNBQVNDLEVBQVdGLEdBQ2xCQSxFQUFNNUcsVUFBVUMsT0FBTyxjQUN2QkosU0FBU2tILG9CQUFvQixVQUFXRixFQUMxQyxDQUVBLFNBQVNBLEVBQWFHLEdBQ3BCLEdBQWdCLFdBQVpBLEVBQUlDLElBQWtCLENBQ3hCLE1BQU1DLEVBQWNySCxTQUFTQyxjQUFjLGVBQ3ZDb0gsR0FDRkosRUFBV0ksRUFFZixDQUNGLENBZ0ZBLFNBQVN6QyxFQUFlSCxHQUN0QixNQUFNRSxFQUFjdUIsRUFBYW9CLFFBQzlCckgsY0FBYyxTQUNkc0gsV0FBVSxHQUVQQyxFQUFtQjdDLEVBQVkxRSxjQUFjLGdCQUM3Q3dILEVBQW1COUMsRUFBWTFFLGNBQWMsZ0JBQzdDeUgsRUFBaUIvQyxFQUFZMUUsY0FBYyxzQkFDM0MwSCxFQUFtQmhELEVBQVkxRSxjQUFjLHdCQW1DbkQsT0FqQ0F1SCxFQUFpQnRILFlBQWN1RSxFQUFLbEIsS0FDcENrRSxFQUFpQnZDLElBQU1ULEVBQUtULEtBQzVCeUQsRUFBaUJHLElBQU1uRCxFQUFLbEIsS0FHeEJrQixFQUFLTCxTQUNQc0QsRUFBZXZILFVBQVVZLElBQUksMkJBRy9CMkcsRUFBZXRHLGlCQUFpQixTQUFVK0YsSUFDeEMsTUFBTS9DLEVBQVUrQyxFQUFJVSxPQUFPMUgsVUFBVTJILFNBQVMsMkJBQzlDL0YsRUFDR29DLGlCQUFpQk0sRUFBS3NELElBQUszRCxHQUMzQnRCLE1BQU0yQixJQUNMaUQsRUFBZXZILFVBQVU2SCxPQUFPLDBCQUEwQixJQUUzRDdDLE1BQU1DLFFBQVFDLE1BQU0sSUFHekJzQyxFQUFpQnZHLGlCQUFpQixTQUFTLEtBRXpDd0YsRUFBZWpDLEVBQ2ZrQyxFQUFpQnBDLEVBQUtzRCxJQUN0QmpCLEVBQVVKLEVBQVksSUFHeEJlLEVBQWlCckcsaUJBQWlCLFNBQVMsS0FDekMwRixFQUFVWCxHQUNWQyxFQUFrQmxCLElBQU1ULEVBQUtULEtBQzdCb0MsRUFBa0J3QixJQUFNbkQsRUFBS2xCLEtBQzdCOEMsRUFBb0JuRyxZQUFjdUUsRUFBS2xCLElBQUksSUFHdENvQixDQUNULENBckdBNEIsRUFBYW5GLGlCQUFpQixTQUFTLEtBQ3JDMEYsRUFBVVIsRUFBWSxJQUV4QkUsRUFBV3BGLGlCQUFpQixVQW5CNUIsU0FBNEIrRixHQUMxQkEsRUFBSWMsaUJBQ0osTUFBTUMsRUFBYWYsRUFBSWdCLFVBQ3ZCekcsRUFBY3dHLEdBQVksRUFBTUEsRUFBV2hJLFlBQWEsYUFDeEQ2QixFQUNHNkIsZUFBZTZDLEVBQVkyQixPQUMzQnRGLE1BQU0yQixJQUNMZ0MsRUFBWXZHLFlBQWN1RSxFQUFLWixPQUMvQm9ELEVBQVdYLEVBQVksSUFFeEJuQixNQUFNQyxRQUFRQyxPQUNkZ0QsU0FBUSxLQUNQM0csRUFBY3dHLEdBQVksRUFBT0EsRUFBV2hJLFlBQWEsWUFBWSxHQUUzRSxJQVFxQkYsU0FBU21CLGlCQUFpQix3QkFHL0NtRSxFQUFPakUsU0FBUzBGLElBQ2RBLEVBQU0zRixpQkFBaUIsYUFBYytGLElBQy9CQSxFQUFJVSxPQUFPMUgsVUFBVTJILFNBQVMsZUFDaENiLEVBQVdGLEdBRVRJLEVBQUlVLE9BQU8xSCxVQUFVMkgsU0FBUyx3QkFDaENiLEVBQVdGLEdBRVRJLEVBQUlVLE9BQU8xSCxVQUFVMkgsU0FBUyxnQ0FDaENiLEVBQVdGLEVBQ2IsR0FDQSxJQXVCSnhCLEVBQWtCbkUsaUJBQWlCLFNBQVMsS0FDMUNzRSxFQUFpQjBDLE1BQVFyRCxFQUFZN0UsWUFDckN5RixFQUF3QnlDLE1BQVFwRCxFQUFtQjlFLFlGdkp0Qm9JLEVBQUMxSSxFQUFhVSxFQUFXbEIsS0FDdERrQixFQUFVZSxTQUFTWixJQUNqQmQsRUFBZUMsRUFBYWEsRUFBT3JCLEVBQVMsR0FDNUMsRUVxSkZrSixDQUNFN0MsRUFDQSxDQUFDQyxFQUFrQkMsR0FDbkJ2RyxHQUVGMEgsRUFBVXRCLEVBQWlCLElBRzdCQyxFQUFnQnJFLGlCQUFpQixVQTlCakMsU0FBcUMrRixHQUNuQ0EsRUFBSWMsaUJBQ0osTUFBTUMsRUFBYWYsRUFBSWdCLFVBQ3ZCekcsRUFBY3dHLEdBQVksRUFBTUEsRUFBV2hJLFlBQWEsYUFDeEQ2QixFQUNHc0IsYUFBYSxDQUNaRSxLQUFNbUMsRUFBaUIwQyxNQUN2QjVFLE1BQU9tQyxFQUF3QnlDLFFBRWhDdEYsTUFBTTJCLElBQ0xNLEVBQVk3RSxZQUFjdUUsRUFBS2xCLEtBQy9CeUIsRUFBbUI5RSxZQUFjdUUsRUFBS2pCLE1BQ3RDeUQsRUFBV3pCLEVBQWlCLElBRTdCTCxNQUFNQyxRQUFRQyxPQUNkZ0QsU0FBUSxLQUNQM0csRUFBY3dHLEdBQVksRUFBT0EsRUFBV2hJLFlBQWEsWUFBWSxHQUUzRSxJQW1GQXlHLEVBQVd2RixpQkFBaUIsVUFyQjVCLFNBQTRCK0YsR0FDMUJBLEVBQUljLGlCQUNKLE1BQU1NLEVBQWVwQixFQUFJZ0IsVUFDekJ6RyxFQUFjNkcsR0FBYyxFQUFNQSxFQUFhckksWUFBYSxlQUM1RDZCLEVBQ0drQyxXQUFXNEMsR0FDWC9ELE1BQU0yQixJQUNMd0MsRUFBV1AsR0FDWEUsRUFBYXhHLFFBQVEsSUFFdEIrRSxNQUFNQyxRQUFRQyxPQUNkZ0QsU0FBUSxLQUNQM0csRUFDRTZHLEdBQ0EsRUFDQUEsRUFBYXJJLFlBQ2IsY0FDRCxHQUVQLElBS0EyRixFQUFjekUsaUJBQWlCLFNBQVMsS0FDdEMwRixFQUFVbEIsRUFBYSxJQXVCekJFLEVBQVkxRSxpQkFBaUIsVUFwQjdCLFNBQWlDK0YsR0FDL0JBLEVBQUljLGlCQUVKLE1BQU1DLEVBQWFmLEVBQUlnQixVQUN2QnpHLEVBQWN3RyxHQUFZLEVBQU1BLEVBQVdoSSxZQUFhLGFBQ3hENkIsRUFDRytCLFlBQVksQ0FBRVAsS0FBTTBDLEVBQWlCbUMsTUFBT3BFLEtBQU1nQyxFQUFjb0MsUUFDaEV0RixNQUFNMkIsSUFDTCxNQUFNRSxFQUFjQyxFQUFlSCxHQUNuQ0ksRUFBVTJELFFBQVE3RCxHQUNsQnNDLEVBQVdyQixHQUNYRSxFQUFZMkMsUUFDWjVILEVBQWNrRixFQUFxQjNHLEVBQVMsSUFFN0MrRixNQUFNQyxRQUFRQyxPQUNkZ0QsU0FBUSxLQUNQM0csRUFBY3dHLEdBQVksRUFBT0EsRUFBV2hJLFlBQWEsWUFBWSxHQUUzRSxJRnJPTyxTQUEwQmQsR0FDZFksU0FBU21CLGlCQUFpQi9CLEVBQVNDLGNBQzNDZ0MsU0FBU3pCLElBQ2hCb0IsRUFBa0JwQixFQUFzQixHQUU1QyxDRW9PQThJLENBQWlCdEosRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b24tc3VibWl0XCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbi1zdWJtaXRfZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTXNnLCBzZXR0aW5ncykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0lkID0gaW5wdXRFbGVtZW50LmlkICsgXCItZXJyb3JcIjtcbiAgY29uc3QgZXJyb3JNc2dFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNcIiArIGVycm9yTXNnSWQpO1xuICBlcnJvck1zZ0VsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnSWQgPSBpbnB1dEVsZW1lbnQuaWQgKyBcIi1lcnJvclwiO1xuICBjb25zdCBlcnJvck1zZ0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1wiICsgZXJyb3JNc2dJZCk7XG4gIGVycm9yTXNnRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihcbiAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLFxuICAgICAgc2V0dGluZ3NcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKTtcbiAgfVxufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dC52YWxpZGl0eS52YWxpZDtcbiAgfSk7XG59O1xuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBzZXR0aW5ncykgPT4ge1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXQsIHNldHRpbmdzKTtcbiAgfSk7XG59O1xuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmlucHV0U2VsZWN0b3IpXG4gICk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICk7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG5cbiAgZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2V0XCIsICgpID0+IHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcbiAgfSk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKSB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCBzZXR0aW5ncyk7XG4gIH0pO1xufVxuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoYnV0dG9uLCBpc0xvYWRpbmcsIGRlZmF1bHRUZXh0LCBsb2FkaW5nVGV4dCkge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XG4gIH1cbn1cbiIsImltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcbmltcG9ydCB7IHNldEJ1dHRvblRleHQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVycy5qc1wiO1xuXG5jb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzEtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkdvbGRlbiBHYXRlIGJyaWRnZVwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy83LXBob3RvLWJ5LWdyaWZmaW4td29vbGRyaWRnZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbl07XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjdjZTMyNzUyLTdmNTEtNGVlMy04ZGFhLWUwODg1ODc5MjA4OVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHByb2ZpbGVJbmZvLCBhdmF0YXJJbWFnZV0pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgY2FyZHNMaXN0LmFwcGVuZChjYXJkRWxlbWVudCk7XG4gICAgfSk7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBwcm9maWxlSW5mby5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHByb2ZpbGVJbmZvLmFib3V0O1xuICAgIGdldEF2YXRhckltYWdlKGF2YXRhckltYWdlKTtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG4vLyBHZW5lcmFsIHZhcmlhYmxlXG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuXG4vLyBQcm9maWxlIHZhcmlhYmxlc1xuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgcHJvZmlsZUNsb3NlQnV0dG9uID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCJcbik7XG5cbi8vIFByb2ZpbGUgRm9ybSB2YXJpYWJsZXNcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcblxuLy8gTmV3IHBvc3QvYWRkIGNhcmQgdmFyaWFsYmVzXG5jb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsXCIpO1xuY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmV3LXBvc3QtYnV0dG9uXCIpO1xuY29uc3QgYWRkQ2FyZEZvcm0gPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGFkZENhcmRDbG9zZUJ1dHRvbiA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b24tY2xvc2VcIik7XG5jb25zdCBhZGRDYXJkQnV0dG9uU3VibWl0ID0gYWRkQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1zdWJtaXRcIik7XG5cbi8vIE5ldyBwb3N0L2FkZCBjYXJkIGZvcm0gdmFyaWFibGVzXG5jb25zdCBjYXJkTGlua0lucHV0ID0gYWRkQ2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xuY29uc3QgY2FyZENhcHRpb25JbnB1dCA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtY2FwdGlvbi1pbnB1dFwiKTtcblxuLy8gQ2FyZCBsaXN0IHZhcmlhYmxlc1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuLy8gUHJldmlldyBtb2RhbCBFbGVtZW50IHNlbGVjdG9yXG5jb25zdCBwcmV2aWV3TW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsSW1hZ2UgPSBwcmV2aWV3TW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbiA9XG4gIHByZXZpZXdNb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcbi8vY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdXR0b24gPSBwcmV2aWV3TW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4vLyAgXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiXG4vLyk7XG5cbi8vIEF2YXRhciBmb3JtIGVsZW1lbnRzXG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xuY29uc3QgYXZhdGFyRm9ybSA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4vL2NvbnN0IGF2YXRhckNsb3NlQnV0dG9uID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCIpO1xuY29uc3QgYXZhdGFyQnV0dG9uU3VibWl0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLXN1Ym1pdFwiKTtcbmNvbnN0IGF2YXRhcklucHV0ID0gYXZhdGFyRm9ybS5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1pbnB1dFwiKTtcbmNvbnN0IGF2YXRhckltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuXG4vLyBEZWxldGUgZm9ybSBlbGVtZW50cyBhbmQgY29uc3RzXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5sZXQgc2VsZWN0ZWRDYXJkO1xubGV0IHNlbGVjdGVkQ2FyZElkO1xuXG4vLyBHZW5lcmFsIGZvcm0gZnVuY3Rpb25zXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5cIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5cIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVzY2FwZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBhY3RpdmVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlblwiKTtcbiAgICBpZiAoYWN0aXZlTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwoYWN0aXZlTW9kYWwpO1xuICAgIH1cbiAgfVxufVxuLy8gZ2V0IGF2YXRhciBpbWFnZVxuZnVuY3Rpb24gZ2V0QXZhdGFySW1hZ2UoZGF0YSkge1xuICBhdmF0YXJJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5saW5rO1xufVxuXG4vLyBlZGl0IGF2YXRhciBmdW5jdGlvbnNcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHNhdmVCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHNhdmVCdXR0b24sIHRydWUsIHNhdmVCdXR0b24udGV4dENvbnRlbnQsIFwiU2F2aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZWRpdEF2YXRhckluZm8oYXZhdGFySW5wdXQudmFsdWUpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGF2YXRhcklucHV0LnRleHRDb250ZW50ID0gZGF0YS5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc2F2ZUJ1dHRvbiwgZmFsc2UsIHNhdmVCdXR0b24udGV4dENvbnRlbnQsIFwiU2F2aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuXG5hdmF0YXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbi8vIEZpbmQgYWxsIGNsb3NlIGJ1dHRvbnNcbmNvbnN0IGNsb3NlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiKTtcblxuLy8gSGFuZGxlIG1vZGFsIGNsb3NpbmcgYWZ0ZXIgY2xpY2tpbmcgb3ZlcmxheSBvciBjbG9zZSBidXR0b25cbm1vZGFscy5mb3JFYWNoKChtb2RhbCkgPT4ge1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuXCIpKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2J1dHRvbi1jbG9zZVwiKSkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX19idXR0b24tc3VibWl0X2NhbmNlbFwiKSkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG4vLyBFZGl0IHByb2ZpbGUgZnVuY3Rpb25zXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzYXZlQnV0dG9uID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzYXZlQnV0dG9uLCB0cnVlLCBzYXZlQnV0dG9uLnRleHRDb250ZW50LCBcIlNhdmluZy4uLlwiKTtcbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBwcm9maWxlTmFtZUlucHV0LnZhbHVlLFxuICAgICAgYWJvdXQ6IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHNhdmVCdXR0b24sIGZhbHNlLCBzYXZlQnV0dG9uLnRleHRDb250ZW50LCBcIlNhdmluZy4uLlwiKTtcbiAgICB9KTtcbn1cbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBwcm9maWxlRWRpdEZvcm0sXG4gICAgW3Byb2ZpbGVOYW1lSW5wdXQsIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcbiAgICBzZXR0aW5nc1xuICApO1xuICBvcGVuTW9kYWwocHJvZmlsZUVkaXRNb2RhbCk7XG59KTtcblxucHJvZmlsZUVkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUVkaXRGb3JtU3VibWl0KTtcblxuLy8gQ2FyZCBmdW5jdGlvbnNcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudFxuICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xuXG4gIGNvbnN0IGNhcmRUaXRsZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuXG4gIGNhcmRUaXRsZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZUVsZW1lbnQuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbGVtZW50LmFsdCA9IGRhdGEubmFtZTtcblxuICAvL21haW50YWlucyBhY3RpdmUgc3RhdHVzIHRvIGxpa2UgYWZ0ZXIgcmVmcmVzaFxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICBjb25zdCBpc0xpa2VkID0gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgICBhcGlcbiAgICAgIC5jaGFuZ2VMaWtlU3RhdHVzKGRhdGEuX2lkLCBpc0xpa2VkKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSk7XG5cbiAgY2FyZERlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIC8vY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbEVsZW1lbnQpO1xuICAgIHByZXZpZXdNb2RhbEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3TW9kYWxJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vL2hhbmRsZSBkZWxldGUgZm9ybSByZXF1ZXN0IGxpc3RlbmVyXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBkZWxldGVCdXR0b24gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KGRlbGV0ZUJ1dHRvbiwgdHJ1ZSwgZGVsZXRlQnV0dG9uLnRleHRDb250ZW50LCBcIkRlbGV0aW5nLi4uXCIpO1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KFxuICAgICAgICBkZWxldGVCdXR0b24sXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBkZWxldGVCdXR0b24udGV4dENvbnRlbnQsXG4gICAgICAgIFwiRGVsZXRpbmcuLi5cIlxuICAgICAgKTtcbiAgICB9KTtcbn1cblxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG4vL2FkZCBjYW5jZWwgZXZlbnQgbGlzdGVuZXJcbi8vIE5ldy9hZGQgY2FyZCBmdW5jdGlvbnNcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGFkZENhcmRNb2RhbCk7XG59KTtcblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAvL2NvbnN0IG5ld0NhcmQgPSB7IG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfTtcbiAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc2F2ZUJ1dHRvbiwgdHJ1ZSwgc2F2ZUJ1dHRvbi50ZXh0Q29udGVudCwgXCJTYXZpbmcuLi5cIik7XG4gIGFwaVxuICAgIC5hZGRDYXJkSW5mbyh7IG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKGNhcmRFbGVtZW50KTtcbiAgICAgIGNsb3NlTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbiAgICAgIGFkZENhcmRGb3JtLnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGFkZENhcmRCdXR0b25TdWJtaXQsIHNldHRpbmdzKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc2F2ZUJ1dHRvbiwgZmFsc2UsIHNhdmVCdXR0b24udGV4dENvbnRlbnQsIFwiU2F2aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuXG5hZGRDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgICAgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSxcbiAgICAgIHRoaXMuZ2V0VXNlckluZm8oKSxcbiAgICAgIHRoaXMuZ2V0QXZhdGFySW5mbygpLFxuICAgIF0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuICBlZGl0QXZhdGFySW5mbyhhdmF0YXIpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEF2YXRhckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBhZGRDYXJkSW5mbyh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoY2FyZElkLCBpc0xpa2VkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsZW1lbnQiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1zZ0lkIiwiaWQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJzZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZm9yRWFjaCIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNc2ciLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNldEJ1dHRvblRleHQiLCJidXR0b24iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwiYXBpIiwiY29uc3RydWN0b3IiLCJfcmVmIiwiYmFzZVVybCIsImhlYWRlcnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldEFwcEluZm8iLCJQcm9taXNlIiwiYWxsIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJnZXRBdmF0YXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwibWV0aG9kIiwiZWRpdFVzZXJJbmZvIiwiX3JlZjIiLCJuYW1lIiwiYWJvdXQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRBdmF0YXJJbmZvIiwiYXZhdGFyIiwiYWRkQ2FyZEluZm8iLCJfcmVmMyIsImxpbmsiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwiY2hhbmdlTGlrZVN0YXR1cyIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJwcm9maWxlSW5mbyIsImF2YXRhckltYWdlIiwiZGF0YSIsImNhcmQiLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwiYXBwZW5kIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJhdmF0YXJJbWFnZUVsZW1lbnQiLCJzcmMiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsIm1vZGFscyIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUVkaXRNb2RhbCIsInByb2ZpbGVFZGl0Rm9ybSIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImFkZENhcmRNb2RhbCIsImFkZENhcmRCdXR0b24iLCJhZGRDYXJkRm9ybSIsImFkZENhcmRCdXR0b25TdWJtaXQiLCJjYXJkTGlua0lucHV0IiwiY2FyZENhcHRpb25JbnB1dCIsImNhcmRUZW1wbGF0ZSIsInByZXZpZXdNb2RhbEVsZW1lbnQiLCJwcmV2aWV3TW9kYWxJbWFnZSIsInByZXZpZXdNb2RhbENhcHRpb24iLCJhdmF0YXJNb2RhbCIsImF2YXRhckJ1dHRvbiIsImF2YXRhckZvcm0iLCJhdmF0YXJJbnB1dCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwib3Blbk1vZGFsIiwibW9kYWwiLCJoYW5kbGVFc2NhcGUiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsImFjdGl2ZU1vZGFsIiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZUVsZW1lbnQiLCJjYXJkSW1hZ2VFbGVtZW50IiwiY2FyZExpa2VCdXR0b24iLCJjYXJkRGVsZXRlQnV0dG9uIiwiYWx0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJfaWQiLCJ0b2dnbGUiLCJwcmV2ZW50RGVmYXVsdCIsInNhdmVCdXR0b24iLCJzdWJtaXR0ZXIiLCJ2YWx1ZSIsImZpbmFsbHkiLCJyZXNldFZhbGlkYXRpb24iLCJkZWxldGVCdXR0b24iLCJwcmVwZW5kIiwicmVzZXQiLCJlbmFibGVWYWxpZGF0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==