!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button-submit",inactiveButtonClass:"modal__button-submit_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=t.id+"-error";document.querySelector("#"+o).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=n=>{const a=Array.from(n.querySelectorAll(e.inputSelector)),s=n.querySelector(e.submitButtonSelector);r(a,s,e),n.addEventListener("reset",(()=>{o(s,e)})),a.forEach((o=>{o.addEventListener("input",(function(){((e,r,o)=>{r.validity.valid?t(0,r,o):((e,t,r,o)=>{const n=t.id+"-error";document.querySelector("#"+n).textContent=r,t.classList.add(o.inputErrorClass)})(0,r,r.validationMessage,o)})(0,o,e),r(a,s,e)}))}))},a=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards()],[this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}addCardInfo(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"7ce32752-7f51-4ee3-8daa-e08858792089","Content-Type":"application/json"}});a.getAppInfo().then((e=>{let[t]=e;t.forEach((e=>{const t=T(e);q.append(t)}))})).catch(console.error);const s=document.querySelectorAll(".modal"),l=document.querySelector(".profile__edit-button"),c=document.querySelector("#profile-edit-modal"),d=c.querySelector(".modal__form"),i=(c.querySelector(".modal__button-close"),document.querySelector(".profile__name")),u=document.querySelector(".profile__description"),m=c.querySelector("#profile-name-input"),_=c.querySelector("#profile-description-input"),h=document.querySelector("#add-card-modal"),f=document.querySelector(".profile__new-post-button"),y=h.querySelector(".modal__form"),p=(h.querySelector(".modal__button-close"),h.querySelector(".modal__button-submit")),v=y.querySelector("#add-card-link-input"),S=y.querySelector("#add-card-caption-input"),b=document.querySelector("#card-template"),q=document.querySelector(".cards__list"),E=document.querySelector("#preview-modal"),C=E.querySelector(".modal__image"),L=E.querySelector(".modal__caption"),k=document.querySelector("#avatar-modal"),g=document.querySelector(".profile__avatar-button"),j=k.querySelector(".modal__form"),U=(k.querySelector(".modal__button-submit"),j.querySelector("#avatar-input")),$=document.querySelector("#delete-modal"),I=$.querySelector(".modal__form");let A,P;function x(e){e.classList.add("modal_open"),document.addEventListener("keydown",B)}function w(e){e.classList.remove("modal_open"),document.removeEventListener("keydown",B)}function B(e){if("Escape"===e.key){const e=document.querySelector(".modal_open");e&&w(e)}}function T(e){const t=b.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button");return r.textContent=e.name,o.src=e.link,o.alt=e.name,n.addEventListener("click",(()=>{n.classList.toggle("card__like-button_liked")})),a.addEventListener("click",(r=>{A=t,P=e._id,x($)})),o.addEventListener("click",(()=>{x(E),C.src=e.link,C.alt=e.name,L.textContent=e.name})),t}g.addEventListener("click",(()=>{x(k)})),j.addEventListener("submit",(function(e){e.preventDefault(),a.editAvatarInfo(U.value).then((e=>{U.textContent=e.avatar,w(k)})).catch(console.error)})),document.querySelectorAll(".modal__button-close"),s.forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("modal_open")&&w(e),t.target.classList.contains("modal__button-close")&&w(e)}))})),l.addEventListener("click",(()=>{m.value=i.textContent,_.value=u.textContent,((e,r,o)=>{r.forEach((e=>{t(0,e,o)}))})(0,[m,_],e),x(c)})),d.addEventListener("submit",(function(e){e.preventDefault(),a.editUserInfo({name:m.value,about:_.value}).then((e=>{i.textContent=e.name,u.textContent=e.about,w(c)})).catch(console.error)})),I.addEventListener("submit",(function(e){e.preventDefault(),a.deleteCard(P).then((e=>{console.log(e),w($),A.remove()})).catch(console.error)})),f.addEventListener("click",(()=>{x(h)})),y.addEventListener("submit",(function(t){t.preventDefault(),a.addCardInfo({name:S.value,link:v.value}).then((t=>{const r=T(t);q.prepend(r),w(h),y.reset(),disableButton(p,e)})).catch(console.error)})),function(e){document.querySelectorAll(e.formSelector).forEach((e=>{n(e)}))}(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UCxLQUFNbUMsRUFBaUJpQyxNQUFPM0QsS0FBTXlCLEVBQWNrQyxRQUNoRTdFLE1BQU1pRSxJQUNMLE1BQU16QyxFQUFjQyxFQUFld0MsR0FDbkN2QyxFQUFVd0QsUUFBUTFELEdBQ2xCb0MsRUFBV3JCLEdBQ1hFLEVBQVkwQyxRQUNaOUcsY0FBY3FFLEVBQXFCOUYsRUFBUyxJQUU3Q2dGLE1BQU1DLFFBQVFDLE1BQ25CLElEbkxPLFNBQTBCbEYsR0FDZFksU0FBU21CLGlCQUFpQi9CLEVBQVNDLGNBQzNDZ0MsU0FBU3pCLElBQ2hCb0IsRUFBa0JwQixFQUFzQixHQUU1QyxDQ2tMQWdJLENBQWlCeEksRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX2J1dHRvbi1zdWJtaXRcIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uLXN1Ym1pdF9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNc2csIHNldHRpbmdzKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnSWQgPSBpbnB1dEVsZW1lbnQuaWQgKyBcIi1lcnJvclwiO1xuICBjb25zdCBlcnJvck1zZ0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI1wiICsgZXJyb3JNc2dJZCk7XG4gIGVycm9yTXNnRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTXNnO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dJZCA9IGlucHV0RWxlbWVudC5pZCArIFwiLWVycm9yXCI7XG4gIGNvbnN0IGVycm9yTXNnRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjXCIgKyBlcnJvck1zZ0lkKTtcbiAgZXJyb3JNc2dFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncykgPT4ge1xuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKFxuICAgICAgZm9ybUVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXG4gICAgICBzZXR0aW5nc1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xuICB9XG59O1xuXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5cbmNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChzZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgc2V0dGluZ3MpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBzZXR0aW5ncyk7XG4gIH0pO1xufTtcbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50KSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvclxuICApO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuXG4gIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNldFwiLCAoKSA9PiB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbGVtZW50LCBzZXR0aW5ncyk7XG4gIH0pO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIHNldHRpbmdzKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncykge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcbn1cbiIsImltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBicmlkZ2VcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG5dO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCI3Y2UzMjc1Mi03ZjUxLTRlZTMtOGRhYS1lMDg4NTg3OTIwODlcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZCk7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGNhcmRFbGVtZW50KTtcbiAgICB9KTtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG4vLyBHZW5lcmFsIHZhcmlhYmxlXG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuXG4vLyBQcm9maWxlIHZhcmlhYmxlc1xuY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIpO1xuY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgcHJvZmlsZUNsb3NlQnV0dG9uID0gcHJvZmlsZUVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCJcbik7XG5cbi8vIFByb2ZpbGUgRm9ybSB2YXJpYWJsZXNcbmNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcblxuLy8gTmV3IHBvc3QvYWRkIGNhcmQgdmFyaWFsYmVzXG5jb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsXCIpO1xuY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmV3LXBvc3QtYnV0dG9uXCIpO1xuY29uc3QgYWRkQ2FyZEZvcm0gPSBhZGRDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGFkZENhcmRDbG9zZUJ1dHRvbiA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b24tY2xvc2VcIik7XG5jb25zdCBhZGRDYXJkQnV0dG9uU3VibWl0ID0gYWRkQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1zdWJtaXRcIik7XG5cbi8vIE5ldyBwb3N0L2FkZCBjYXJkIGZvcm0gdmFyaWFibGVzXG5jb25zdCBjYXJkTGlua0lucHV0ID0gYWRkQ2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xuY29uc3QgY2FyZENhcHRpb25JbnB1dCA9IGFkZENhcmRGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtY2FwdGlvbi1pbnB1dFwiKTtcblxuLy8gQ2FyZCBsaXN0IHZhcmlhYmxlc1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuLy8gUHJldmlldyBtb2RhbCBFbGVtZW50IHNlbGVjdG9yXG5jb25zdCBwcmV2aWV3TW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsSW1hZ2UgPSBwcmV2aWV3TW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbiA9XG4gIHByZXZpZXdNb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcbi8vY29uc3QgcHJldmlld01vZGFsQ2xvc2VCdXR0b24gPSBwcmV2aWV3TW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4vLyAgXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiXG4vLyk7XG5cbi8vIEF2YXRhciBmb3JtIGVsZW1lbnRzXG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgYXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xuY29uc3QgYXZhdGFyRm9ybSA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4vL2NvbnN0IGF2YXRhckNsb3NlQnV0dG9uID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCIpO1xuY29uc3QgYXZhdGFyQnV0dG9uU3VibWl0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLXN1Ym1pdFwiKTtcbmNvbnN0IGF2YXRhcklucHV0ID0gYXZhdGFyRm9ybS5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1pbnB1dFwiKTtcblxuLy8gRGVsZXRlIGZvcm0gZWxlbWVudHMgYW5kIGNvbnN0c1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcblxuLy8gR2VuZXJhbCBmb3JtIGZ1bmN0aW9uc1xuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGUpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGUpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFc2NhcGUoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgYWN0aXZlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5cIik7XG4gICAgaWYgKGFjdGl2ZU1vZGFsKSB7XG4gICAgICBjbG9zZU1vZGFsKGFjdGl2ZU1vZGFsKTtcbiAgICB9XG4gIH1cbn1cbi8vIGVkaXQgYXZhdGFyIGZ1bmN0aW9uc1xuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgYXBpXG4gICAgLmVkaXRBdmF0YXJJbmZvKGF2YXRhcklucHV0LnZhbHVlKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBhdmF0YXJJbnB1dC50ZXh0Q29udGVudCA9IGRhdGEuYXZhdGFyO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbmF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyU3VibWl0KTtcblxuLy8gRmluZCBhbGwgY2xvc2UgYnV0dG9uc1xuY29uc3QgY2xvc2VCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCIpO1xuXG4vLyBIYW5kbGUgbW9kYWwgY2xvc2luZyBhZnRlciBjbGlja2luZyBvdmVybGF5IG9yIGNsb3NlIGJ1dHRvblxubW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGV2dCkgPT4ge1xuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5cIikpIHtcbiAgICAgIGNsb3NlTW9kYWwobW9kYWwpO1xuICAgIH1cbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fYnV0dG9uLWNsb3NlXCIpKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbi8vIEVkaXQgcHJvZmlsZSBmdW5jdGlvbnNcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0Rm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKHByb2ZpbGVFZGl0TW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIHByb2ZpbGVFZGl0Rm9ybSxcbiAgICBbcHJvZmlsZU5hbWVJbnB1dCwgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXRdLFxuICAgIHNldHRpbmdzXG4gICk7XG4gIG9wZW5Nb2RhbChwcm9maWxlRWRpdE1vZGFsKTtcbn0pO1xuXG5wcm9maWxlRWRpdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRWRpdEZvcm1TdWJtaXQpO1xuXG4vLyBDYXJkIGZ1bmN0aW9uc1xuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jb250ZW50XG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZFRpdGxlRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG5cbiAgY2FyZFRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgY2FyZEltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWx0ID0gZGF0YS5uYW1lO1xuXG4gIGNhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2xpa2VkXCIpO1xuICB9KTtcblxuICBjYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgLy9jYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICAgIG9wZW5Nb2RhbChkZWxldGVNb2RhbCk7XG4gIH0pO1xuXG4gIGNhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsRWxlbWVudCk7XG4gICAgcHJldmlld01vZGFsSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdNb2RhbEltYWdlLmFsdCA9IGRhdGEubmFtZTtcbiAgICBwcmV2aWV3TW9kYWxDYXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbi8vaGFuZGxlIGRlbGV0ZSBmb3JtIHJlcXVlc3QgbGlzdGVuZXJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbi8vIE5ldy9hZGQgY2FyZCBmdW5jdGlvbnNcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGFkZENhcmRNb2RhbCk7XG59KTtcblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZEZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAvL2NvbnN0IG5ld0NhcmQgPSB7IG5hbWU6IGNhcmRDYXB0aW9uSW5wdXQudmFsdWUsIGxpbms6IGNhcmRMaW5rSW5wdXQudmFsdWUgfTtcbiAgYXBpXG4gICAgLmFkZENhcmRJbmZvKHsgbmFtZTogY2FyZENhcHRpb25JbnB1dC52YWx1ZSwgbGluazogY2FyZExpbmtJbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGRhdGEpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgICAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xuICAgICAgYWRkQ2FyZEZvcm0ucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdXR0b24oYWRkQ2FyZEJ1dHRvblN1Ym1pdCwgc2V0dGluZ3MpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5hZGRDYXJkRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRGb3JtU3VibWl0KTtcblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCldLCBbdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkQ2FyZEluZm8oeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNc2dJZCIsImlkIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZvckVhY2giLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTXNnIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsIm1ldGhvZCIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImFkZENhcmRJbmZvIiwiX3JlZjMiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImF1dGhvcml6YXRpb24iLCJjYXJkcyIsImNhcmQiLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwiYXBwZW5kIiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJtb2RhbHMiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVFZGl0TW9kYWwiLCJwcm9maWxlRWRpdEZvcm0iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInByb2ZpbGVOYW1lSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImFkZENhcmRNb2RhbCIsImFkZENhcmRCdXR0b24iLCJhZGRDYXJkRm9ybSIsImFkZENhcmRCdXR0b25TdWJtaXQiLCJjYXJkTGlua0lucHV0IiwiY2FyZENhcHRpb25JbnB1dCIsImNhcmRUZW1wbGF0ZSIsInByZXZpZXdNb2RhbEVsZW1lbnQiLCJwcmV2aWV3TW9kYWxJbWFnZSIsInByZXZpZXdNb2RhbENhcHRpb24iLCJhdmF0YXJNb2RhbCIsImF2YXRhckJ1dHRvbiIsImF2YXRhckZvcm0iLCJhdmF0YXJJbnB1dCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwib3Blbk1vZGFsIiwibW9kYWwiLCJoYW5kbGVFc2NhcGUiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsImFjdGl2ZU1vZGFsIiwiZGF0YSIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbGVtZW50IiwiY2FyZEltYWdlRWxlbWVudCIsImNhcmRMaWtlQnV0dG9uIiwiY2FyZERlbGV0ZUJ1dHRvbiIsInNyYyIsImFsdCIsInRvZ2dsZSIsIl9pZCIsInByZXZlbnREZWZhdWx0IiwidmFsdWUiLCJ0YXJnZXQiLCJjb250YWlucyIsInJlc2V0VmFsaWRhdGlvbiIsImxvZyIsInByZXBlbmQiLCJyZXNldCIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9